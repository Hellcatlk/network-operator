@startuml state

(*) --> [ User create CR ] "<none>"

"<none>" --> "Idle"

"Idle" --> [ spec.configurationRef != nil\n (with exponential backoff)] "Validating"
"Idle" --> [ !instance.DeletionTimestamp.IsZero() ] "Deleting"

"Validating" --> [ Switch Credentials ok + configuration ok ] "Configuring"
"Validating" --> [ Incorrect config ] "Idle"

"Configuring" --> [ Configuration finished ] "Active"
"Configuring" --> [ Error + exponential backoff ] "Validating"

"Active" --> [ Configuration mismatch ] "Configuring"
"Active" --> [ !instance.DeletionTimestamp.IsZero() || spec.configurationRef is nil ] "Cleaning"

"Cleaning" --> [ Clean finished ] "Idle"
"Cleaning" --> [ !instance.DeletionTimestamp.IsZero() ] "Deleting"

"Deleting" --> [ CR have been removed ] (*)

@enduml
